<?php
/**
 * Jscriptz SmartShipping - Label Buttons Template
 *
 * @var \Jscriptz\SmartShipping\Block\Adminhtml\Shipment\LabelButtons $block
 * @var \Magento\Framework\Escaper $escaper
 */

$shipment = $block->getShipment();
if (!$shipment) {
    return;
}

$shipmentId = $shipment->getId();
$format = $block->getLabelFormat();
$baseUrl = $block->getUrl('smartshipping/shipment/getLabel');
?>

<script>
require(['jquery', 'domReady!'], function($) {
    'use strict';

    var printBtn = $('button[title="Print Shipping Label"]');
    if (!printBtn.length) {
        return;
    }

    var shipmentId = '<?= $escaper->escapeJs($shipmentId) ?>';
    var format = '<?= $escaper->escapeJs($format) ?>';
    var baseUrl = '<?= $escaper->escapeJs($baseUrl) ?>';

    var viewUrl = baseUrl + '?shipment_id=' + shipmentId + '&mode=view';
    var downloadUrl = baseUrl + '?shipment_id=' + shipmentId + '&mode=download';

    // Create container for our buttons
    var container = $('<div class="smartshipping-label-buttons"></div>').css({
        'display': 'flex',
        'gap': '10px',
        'flex-wrap': 'wrap',
        'margin': '15px 0'
    });

    // View in Browser button (orange)
    var viewBtn = $('<a></a>')
        .attr('href', viewUrl)
        .attr('target', '_blank')
        .attr('rel', 'noopener')
        .css({
            'display': 'inline-flex',
            'align-items': 'center',
            'padding': '10px 20px',
            'background': '#eb5202',
            'border': '1px solid #eb5202',
            'color': '#fff',
            'font-weight': '600',
            'font-size': '13px',
            'text-decoration': 'none',
            'border-radius': '3px',
            'cursor': 'pointer'
        })
        .html('<span>View in Browser (' + format + ')</span>');

    // Download button (dark)
    var downloadBtn = $('<a></a>')
        .attr('href', downloadUrl)
        .css({
            'display': 'inline-flex',
            'align-items': 'center',
            'padding': '10px 20px',
            'background': '#514943',
            'border': '1px solid #514943',
            'color': '#fff',
            'font-weight': '600',
            'font-size': '13px',
            'text-decoration': 'none',
            'border-radius': '3px',
            'cursor': 'pointer'
        })
        .html('<span>Download Label</span>');

    container.append(viewBtn).append(downloadBtn);

    // Replace the original button's parent paragraph with our container
    printBtn.closest('p').replaceWith(container);
});
</script>
